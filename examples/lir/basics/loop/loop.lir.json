{
  "$schema": "https://raw.githubusercontent.com/Mearman/cairs/main/lir.schema.json",
  "version": "1.0.0",
  "description": "Demonstrates a loop in LIR using a back-edge (jump to previous block). The block executes repeatedly until a condition becomes false.",
  "blocks": [
    {
      "id": "entry",
      "instructions": [
        {
          "kind": "assign",
          "target": "i",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 0
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "loopHeader",
      "instructions": [
        {
          "kind": "assign",
          "target": "limit",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 5
          }
        },
        {
          "kind": "op",
          "target": "condition",
          "ns": "core",
          "name": "lt",
          "args": [
            "i",
            "limit"
          ]
        }
      ],
      "terminator": {
        "kind": "branch",
        "cond": "condition",
        "then": "loopBody",
        "else": "loopExit"
      }
    },
    {
      "id": "loopBody",
      "instructions": [
        {
          "kind": "assign",
          "target": "one",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 1
          }
        },
        {
          "kind": "op",
          "target": "nextI",
          "ns": "core",
          "name": "add",
          "args": [
            "i",
            "one"
          ]
        },
        {
          "kind": "assign",
          "target": "i",
          "value": {
            "kind": "var",
            "name": "nextI"
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "loopExit",
      "instructions": [
        {
          "kind": "assign",
          "target": "result",
          "value": {
            "kind": "var",
            "name": "i"
          }
        }
      ],
      "terminator": {
        "kind": "return",
        "value": "result"
      }
    }
  ],
  "entry": "entry",
  "expected_result": 5,
  "note": "Loop with back-edge: i goes from 0 to 5. Control flow: entry -> loopHeader -> loopBody -> loopHeader -> loopExit"
}
