{
  "$schema": "https://raw.githubusercontent.com/Mearman/cairs/main/lir.schema.json",
  "version": "1.0.0",
  "description": "Implements FizzBuzz logic as a CFG in LIR. For numbers 1-5, returns 'Fizz' for multiples of 3, 'Buzz' for multiples of 5, or the number as string otherwise.",
  "blocks": [
    {
      "id": "entry",
      "instructions": [
        {
          "kind": "assign",
          "target": "initialI",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 1
          }
        },
        {
          "kind": "assign",
          "target": "limit",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 5
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "loopHeader",
      "instructions": [
        {
          "kind": "phi",
          "target": "i",
          "sources": [
            {
              "block": "entry",
              "id": "initialI"
            },
            {
              "block": "returnFizz",
              "id": "nextI"
            },
            {
              "block": "returnBuzz",
              "id": "nextI"
            },
            {
              "block": "default",
              "id": "nextI"
            }
          ]
        },
        {
          "kind": "op",
          "target": "atLimit",
          "ns": "core",
          "name": "gt",
          "args": [
            "i",
            "limit"
          ]
        }
      ],
      "terminator": {
        "kind": "branch",
        "cond": "atLimit",
        "then": "exit",
        "else": "check3"
      }
    },
    {
      "id": "check3",
      "instructions": [
        {
          "kind": "assign",
          "target": "three",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 3
          }
        },
        {
          "kind": "op",
          "target": "rem3",
          "ns": "core",
          "name": "mod",
          "args": [
            "i",
            "three"
          ]
        },
        {
          "kind": "assign",
          "target": "zero",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 0
          }
        },
        {
          "kind": "op",
          "target": "isMult3",
          "ns": "core",
          "name": "eq",
          "args": [
            "rem3",
            "zero"
          ]
        }
      ],
      "terminator": {
        "kind": "branch",
        "cond": "isMult3",
        "then": "returnFizz",
        "else": "check5"
      }
    },
    {
      "id": "check5",
      "instructions": [
        {
          "kind": "assign",
          "target": "five",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 5
          }
        },
        {
          "kind": "op",
          "target": "rem5",
          "ns": "core",
          "name": "mod",
          "args": [
            "i",
            "five"
          ]
        },
        {
          "kind": "assign",
          "target": "zero",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 0
          }
        },
        {
          "kind": "op",
          "target": "isMult5",
          "ns": "core",
          "name": "eq",
          "args": [
            "rem5",
            "zero"
          ]
        }
      ],
      "terminator": {
        "kind": "branch",
        "cond": "isMult5",
        "then": "returnBuzz",
        "else": "default"
      }
    },
    {
      "id": "returnFizz",
      "instructions": [
        {
          "kind": "assign",
          "target": "one",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 1
          }
        },
        {
          "kind": "op",
          "target": "nextI",
          "ns": "core",
          "name": "add",
          "args": [
            "i",
            "one"
          ]
        },
        {
          "kind": "assign",
          "target": "result",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "string"
            },
            "value": "Fizz"
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "returnBuzz",
      "instructions": [
        {
          "kind": "assign",
          "target": "one",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 1
          }
        },
        {
          "kind": "op",
          "target": "nextI",
          "ns": "core",
          "name": "add",
          "args": [
            "i",
            "one"
          ]
        },
        {
          "kind": "assign",
          "target": "result",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "string"
            },
            "value": "Buzz"
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "default",
      "instructions": [
        {
          "kind": "assign",
          "target": "one",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "int"
            },
            "value": 1
          }
        },
        {
          "kind": "op",
          "target": "nextI",
          "ns": "core",
          "name": "add",
          "args": [
            "i",
            "one"
          ]
        },
        {
          "kind": "assign",
          "target": "result",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "string"
            },
            "value": "number"
          }
        }
      ],
      "terminator": {
        "kind": "jump",
        "to": "loopHeader"
      }
    },
    {
      "id": "exit",
      "instructions": [
        {
          "kind": "assign",
          "target": "final",
          "value": {
            "kind": "lit",
            "type": {
              "kind": "string"
            },
            "value": "Buzz"
          }
        }
      ],
      "terminator": {
        "kind": "return",
        "value": "final"
      }
    }
  ],
  "entry": "entry",
  "expected_result": "Buzz",
  "note": "FizzBuzz for 1-5: 1, 2, Fizz(3), 4, Buzz(5). Returns final result 'Buzz'."
}
